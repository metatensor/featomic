<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Sample Selection" href="sample-selection.html"><link rel="prev" title="Computing \(\lambda\)-SOAP features" href="computing-lambda-soap.html">

    <!-- Generated with Sphinx 7.2.6 and Furo 2025.09.25 -->
        <title>Computing density correlations - Featomic 0.6.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/featomic.css?v=191cc0c0" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Featomic 0.6.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">Featomic 0.6.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../get-started/index.html">Getting started</a><input aria-label="Toggle navigation of Getting started" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../get-started/featomic.html">What is featomic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/installation.html">Installation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../get-started/tutorials.html">Tutorials: using featomic from Python</a><input aria-label="Toggle navigation of Tutorials: using featomic from Python" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/first-calculation.html">First descriptor computation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How-to guides</a><input aria-label="Toggle navigation of How-to guides" checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="computing-soap.html">Computing SOAP features</a></li>
<li class="toctree-l2"><a class="reference internal" href="computing-lambda-soap.html">Computing <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP features</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Computing density correlations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-the-bispectrum">Computing the bispectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample-selection.html">Sample Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="property-selection.html">Property Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="keys-selection.html">Keys selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="splined-radial-integral.html">Splined radial integral</a></li>
<li class="toctree-l2"><a class="reference internal" href="long-range.html">Long-range only LODE descriptor</a></li>
<li class="toctree-l2"><a class="reference internal" href="per-pair-equivariant-features.html">Computing per-pair equivariant features</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../references/index.html">Reference guides</a><input aria-label="Toggle navigation of Reference guides" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../references/calculators/index.html">Calculator reference</a><input aria-label="Toggle navigation of Calculator reference" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/spherical-expansion.html">Spherical expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/spherical-expansion-by-pair.html">Spherical expansion by pair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/lode-spherical-expansion.html">LODE spherical expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/soap-radial-spectrum.html">SOAP radial spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/soap-power-spectrum.html">SOAP power spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/atomic-composition.html">Atomic Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/neighbor-list.html">Neighbor List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/sorted-distances.html">Sorted distance vector</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../references/api/index.html">API documentation</a><input aria-label="Toggle navigation of API documentation" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/python/index.html">Python</a><input aria-label="Toggle navigation of Python" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/systems.html">Available system implementations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/calculators.html">Available Calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/misc.html">Miscellaneous</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/cutoff.html">Local environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/density.html">Atomic density</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/basis.html">Basis functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/splines.html">Splined radial integrals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/clebsch-gordan.html">Clebsch-Gordan products</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/torch/index.html">TorchScript</a><input aria-label="Toggle navigation of TorchScript" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/systems.html">System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/calculators.html">Calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/clebsch-gordan.html">Clebsch-Gordan products</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../references/api/torch/cxx/index.html">TorchScript C++ API reference</a><input aria-label="Toggle navigation of TorchScript C++ API reference" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../references/api/torch/cxx/calculators.html">Calculators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../references/api/rust.html">Rust</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/c/index.html">C</a><input aria-label="Toggle navigation of C" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/systems.html">Defining systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/calculators.html">Dealing with calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/cxx/index.html">C++</a><input aria-label="Toggle navigation of C++" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/systems.html">Defining systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/calculators.html">Dealing with calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/misc.html">Miscellaneous</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations/index.html">Explanations</a><input aria-label="Toggle navigation of Explanations" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/concepts.html">Core concepts of featomic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/soap.html">What is SOAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/rotation_adapted.html">Rotation-Adapted Features</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../devdoc/index.html">Developer documentation</a><input aria-label="Toggle navigation of Developer documentation" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../devdoc/get-started.html">Getting started</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../devdoc/how-to/index.html">How-to guides</a><input aria-label="Toggle navigation of How-to guides" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/how-to/new-calculator.html">Adding a new calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/how-to/profiling.html">Profiling calculation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../devdoc/explanations/index.html">Explanations</a><input aria-label="Toggle navigation of Explanations" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/architecture.html">Code organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/interfaces.html">Python and C interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/radial-integral.html">SOAP and LODE radial integrals</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/how-to/density-correlations.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="computing-density-correlations">
<span id="userdoc-how-to-density-correlations"></span><h1>Computing density correlations<a class="headerlink" href="#computing-density-correlations" title="Link to this heading">¶</a></h1>
<p>In a <a class="reference external" href="https://metatensor.github.io/featomic/latest/how-to/computing-lambda-soap.html">previous example</a>,
we computed the <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP <strong>equivariant</strong> descriptor. This tutorial
focuses on the computation of arbitrary body-order descriptors by means of an
auto-correlations of spherical expansion (or ‘density’).</p>
<p>We will explore both <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP — a version of auto-correlations
with body-order 3 (taking into account one central atom and two neighbors) —
an the bispectrum which is a representation with body-order 4.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ase.io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">metatensor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mts</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">featomic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SphericalExpansion</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">featomic.clebsch_gordan</span><span class="w"> </span><span class="kn">import</span> <span class="n">DensityCorrelations</span><span class="p">,</span> <span class="n">EquivariantPowerSpectrum</span>
</pre></div>
</div>
<section id="computing-the-spherical-expansion">
<h2>Computing the spherical expansion<a class="headerlink" href="#computing-the-spherical-expansion" title="Link to this heading">¶</a></h2>
<p>We can define the spherical expansion hyper parameters and compute the density.
This will be used throughout the remainder of the tutorial.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">HYPER_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="s2">&quot;smoothing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShiftedCosine&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;TensorProduct&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_angular&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;radial&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Gto&quot;</span><span class="p">,</span> <span class="s2">&quot;max_radial&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">systems</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;dataset.xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the SphericalExpansion calculator and compute the density</span>
<span class="n">spherical_expansion</span> <span class="o">=</span> <span class="n">SphericalExpansion</span><span class="p">(</span><span class="o">**</span><span class="n">HYPER_PARAMETERS</span><span class="p">)</span>
<span class="n">density</span> <span class="o">=</span> <span class="n">spherical_expansion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span>
</pre></div>
</div>
<p>Move to “neighbor_type” to properties, i.e. remove sparsity in this dimension.</p>
<p>Note: this method should be called with care when computing on a subset of systems
from a larger dataset. If the <code class="docutils literal notranslate"><span class="pre">systems</span></code> being computed contain a subset of the
global atom types, an inconsistent feature dimension will be created. In this case,
the argument to <code class="docutils literal notranslate"><span class="pre">keys_to_properties</span></code> should be specified as a <code class="docutils literal notranslate"><span class="pre">Labels</span></code> object with
all global atom types.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">(</span><span class="s2">&quot;neighbor_type&quot;</span><span class="p">)</span>

<span class="c1"># average number of features per block</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total number of features:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">density</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>total number of features: 320
</pre></div>
</div>
</section>
<section id="density-correlations-to-build-a-lambda-soap">
<h2>Density correlations to build a <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP<a class="headerlink" href="#density-correlations-to-build-a-lambda-soap" title="Link to this heading">¶</a></h2>
<p>We can now use the <code class="docutils literal notranslate"><span class="pre">DensityCorrelations</span></code> calculator and specify that we want to take
a single Clebsch-Gordan (CG) tensor product, i.e. <code class="docutils literal notranslate"><span class="pre">n_correlations=1</span></code>.</p>
<p>During initialization, the calculator computes and stores the CG coefficients. As the
density expansion is up to <code class="docutils literal notranslate"><span class="pre">o3_lambda=3</span></code> and we are doing a single contraction, we
need CG coefficients computed up to <code class="docutils literal notranslate"><span class="pre">o3_lambda=6</span></code> in order to do a full contraction.
Hence, we set <code class="docutils literal notranslate"><span class="pre">max_angular=6</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">density_correlations</span> <span class="o">=</span> <span class="n">DensityCorrelations</span><span class="p">(</span>
    <span class="n">n_correlations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_angular</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This outputs an equivariant power spectrum descriptor of body-order 3, i.e.
<span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP features.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">lambda_soap</span> <span class="o">=</span> <span class="n">density_correlations</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
</pre></div>
</div>
<p>This is not quite equivalent to the result seen in the previous tutorial on
<a class="reference internal" href="../examples/compute-lambda-soap.html#compute-lambda-soap"><span class="std std-ref">computing λ-SOAP</span></a>. The keys contain
dimensions <code class="docutils literal notranslate"><span class="pre">&quot;l_1&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;l_2&quot;</span></code> which for a given block track the angular order of
the blocks from the input combined to create the block in the output
<a class="reference external" href="https://docs.metatensor.org/latest/core/reference/python/tensor.html#metatensor.TensorMap" title="(in metatensor)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TensorMap</span></code></a>.</p>
<p>Keeping these dimensions in the keys is useful to allow for further CG products to be
taken, building more complex descriptors. For now, we can move these key dimensions to
properties. Inspect the metadata before and after moving these dimensions.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;λ-SOAP before keys_to_properties:&quot;</span><span class="p">,</span> <span class="n">lambda_soap</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first block:&quot;</span><span class="p">,</span> <span class="n">lambda_soap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>λ-SOAP before keys_to_properties: Labels(
    o3_lambda  o3_sigma  center_type  l_1  l_2
        0         1           1        0    0
        1         1           1        0    1
                       ...
        5         -1          8        3    3
        6         1           8        3    3
)
first block: TensorBlock
    samples (420): [&#39;system&#39;, &#39;atom&#39;]
    components (1): [&#39;o3_mu&#39;]
    properties (400): [&#39;neighbor_1_type&#39;, &#39;n_1&#39;, &#39;neighbor_2_type&#39;, &#39;n_2&#39;]
    gradients: None
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">lambda_soap</span> <span class="o">=</span> <span class="n">lambda_soap</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">([</span><span class="s2">&quot;l_1&quot;</span><span class="p">,</span> <span class="s2">&quot;l_2&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;λ-SOAP after keys_to_properties:&quot;</span><span class="p">,</span> <span class="n">lambda_soap</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first block:&quot;</span><span class="p">,</span> <span class="n">lambda_soap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>λ-SOAP after keys_to_properties: Labels(
    o3_lambda  o3_sigma  center_type
        0         1           1
        1         1           1
                  ...
        5         -1          8
        6         1           8
)
first block: TensorBlock
    samples (420): [&#39;system&#39;, &#39;atom&#39;]
    components (1): [&#39;o3_mu&#39;]
    properties (1600): [&#39;l_1&#39;, &#39;l_2&#39;, &#39;neighbor_1_type&#39;, &#39;n_1&#39;, &#39;neighbor_2_type&#39;, &#39;n_2&#39;]
    gradients: None
</pre></div>
</div>
<p>This obtains a result that is equivalent to the <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP seen in the
previous tutorial. We can confirm this by computing an <code class="docutils literal notranslate"><span class="pre">EquivariantPowerSpectrum</span></code>
and checking for consistency.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">equivariant_ps_calculator</span> <span class="o">=</span> <span class="n">EquivariantPowerSpectrum</span><span class="p">(</span><span class="n">spherical_expansion</span><span class="p">)</span>
<span class="n">equivariant_ps</span> <span class="o">=</span> <span class="n">equivariant_ps_calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="n">systems</span><span class="p">,</span> <span class="n">neighbors_to_properties</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">mts</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">lambda_soap</span><span class="p">,</span> <span class="n">equivariant_ps</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="computing-the-bispectrum">
<h1>Computing the bispectrum<a class="headerlink" href="#computing-the-bispectrum" title="Link to this heading">¶</a></h1>
<p>Higher body order descriptors can be computed by increasing the <code class="docutils literal notranslate"><span class="pre">n_correlations</span></code>
parameter. The <code class="docutils literal notranslate"><span class="pre">max_angular</span></code> should also be increased to account for the increased
combinations in angular momenta.</p>
<p>With more iterations, the cost of the computation scales unfavourably. Let’s use a
density with small hyper parameters to demonstrate calculation of the bispectrum, a
body-order 4 equivariant descriptor.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">HYPER_PARAMETERS_SMALL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="s2">&quot;smoothing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShiftedCosine&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;TensorProduct&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_angular&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;radial&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Gto&quot;</span><span class="p">,</span> <span class="s2">&quot;max_radial&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Taking two CG combinations of a density expanded to <code class="docutils literal notranslate"><span class="pre">o3_lambda=2</span></code> requires CG
coefficients computed up to <code class="docutils literal notranslate"><span class="pre">max_angular=6</span></code>. This is given by <code class="docutils literal notranslate"><span class="pre">(n_iterations</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span>
<span class="pre">max_angular_density</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the SphericalExpansion calculator and compute the density</span>
<span class="n">spherical_expansion</span> <span class="o">=</span> <span class="n">SphericalExpansion</span><span class="p">(</span><span class="o">**</span><span class="n">HYPER_PARAMETERS_SMALL</span><span class="p">)</span>
<span class="n">density</span> <span class="o">=</span> <span class="n">spherical_expansion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span>
<span class="n">density</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">(</span><span class="s2">&quot;neighbor_type&quot;</span><span class="p">)</span>

<span class="c1"># Initialize DensityCorrelations calculator</span>
<span class="n">density_correlations</span> <span class="o">=</span> <span class="n">DensityCorrelations</span><span class="p">(</span>
    <span class="n">n_correlations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_angular</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Compute the bispectrum</span>
<span class="n">bispectrum</span> <span class="o">=</span> <span class="n">density_correlations</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
</pre></div>
</div>
<p>There are now <code class="docutils literal notranslate"><span class="pre">&quot;neighbor_x_type&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;n_x&quot;</span></code> (which track the radial channel
indices) dimensions created by the product of feature spaces of the 3 density blocks
combined to make each bispectrum block.</p>
<p>For each block, its key contains dimensions tracking the angular order of blocks
combined to create it, namely <code class="docutils literal notranslate"><span class="pre">[&quot;l_1&quot;,</span> <span class="pre">&quot;l_2&quot;,</span> <span class="pre">&quot;k_2&quot;,</span> <span class="pre">&quot;l_3&quot;]</span></code>. The <code class="docutils literal notranslate"><span class="pre">&quot;l_&quot;</span></code>
dimensions track the angular order of the blocks from the original density, while
<code class="docutils literal notranslate"><span class="pre">&quot;k_&quot;</span></code> dimensions track the angular order of intermediate blocks.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bispectrum first block:&quot;</span><span class="p">,</span> <span class="n">bispectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>bispectrum first block: TensorBlock
    samples (420): [&#39;system&#39;, &#39;atom&#39;]
    components (1): [&#39;o3_mu&#39;]
    properties (1728): [&#39;neighbor_1_type&#39;, &#39;n_1&#39;, &#39;neighbor_2_type&#39;, &#39;n_2&#39;, &#39;neighbor_3_type&#39;, &#39;n_3&#39;]
    gradients: None
</pre></div>
</div>
<p>Let’s look at an example. Take the block at index 156:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bispectrum</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">156</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LabelsEntry(o3_lambda=3, o3_sigma=1, center_type=7, l_1=1, l_2=2, k_2=1, l_3=2)
</pre></div>
</div>
<p>This was created in the following way.</p>
<p>First, a block from <code class="docutils literal notranslate"><span class="pre">density</span></code> of angular order <code class="docutils literal notranslate"><span class="pre">l_1=1</span></code> was combined with a block
of order <code class="docutils literal notranslate"><span class="pre">l_2=2</span></code>. Angular momenta coupling rules state that non-zero combinations
can only be created for output blocks with order <code class="docutils literal notranslate"><span class="pre">|</span> <span class="pre">l_1</span> <span class="pre">-</span> <span class="pre">l_2</span> <span class="pre">|</span> <span class="pre">&lt;=</span> <span class="pre">k_2</span> <span class="pre">&lt;=</span> <span class="pre">|</span> <span class="pre">l_1</span> <span class="pre">+</span> <span class="pre">l_2</span>
<span class="pre">|</span></code>, corresponding to <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>. In this case, a block of order <code class="docutils literal notranslate"><span class="pre">k_2=1</span></code> was
created.</p>
<p>Next, this intermediate block of order <code class="docutils literal notranslate"><span class="pre">k_2=1</span></code> was then combined with a block from
the original density of order <code class="docutils literal notranslate"><span class="pre">l_3=2</span></code>. This can again create combinations <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span>
<span class="pre">3]</span></code>, and in this case has been combined to create the output angular order
<code class="docutils literal notranslate"><span class="pre">o3_lambda=3</span></code>.</p>
<p>As before, we can move these symmetry keys to properties and inspect the metadata and
the total size of the features.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bispectrum</span> <span class="o">=</span> <span class="n">bispectrum</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">([</span><span class="s2">&quot;l_1&quot;</span><span class="p">,</span> <span class="s2">&quot;l_2&quot;</span><span class="p">,</span> <span class="s2">&quot;k_2&quot;</span><span class="p">,</span> <span class="s2">&quot;l_3&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first block:&quot;</span><span class="p">,</span> <span class="n">bispectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>first block: TensorBlock
    samples (420): [&#39;system&#39;, &#39;atom&#39;]
    components (1): [&#39;o3_mu&#39;]
    properties (8640): [&#39;l_1&#39;, &#39;l_2&#39;, &#39;k_2&#39;, &#39;l_3&#39;, &#39;neighbor_1_type&#39;, &#39;n_1&#39;, &#39;neighbor_2_type&#39;, &#39;n_2&#39;, &#39;neighbor_3_type&#39;, &#39;n_3&#39;]
    gradients: None
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;total number of features:&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">bispectrum</span><span class="p">]),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>total number of features: 428544
</pre></div>
</div>
<p>Instead of computing the full CG product, a threshold can be defined to limit the
maximum angular order of blocks computed at each step in the iterative CG coupling
steps.</p>
<p>This is controlled by the <code class="docutils literal notranslate"><span class="pre">angular_cutoff</span></code> parameter, and allows us to initialize
the calculator with a lower <code class="docutils literal notranslate"><span class="pre">max_angular</span></code>.</p>
<p>Note that any truncation of the angular channels away from the maximal allowed by
angular momenta coupling rules results in some loss of information.</p>
<p>Let’s truncate to an angular cutoff of 3:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">angular_cutoff</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">density_correlations</span> <span class="o">=</span> <span class="n">DensityCorrelations</span><span class="p">(</span>
    <span class="n">n_correlations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_angular</span><span class="o">=</span><span class="n">angular_cutoff</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">bispectrum_truncated</span> <span class="o">=</span> <span class="n">density_correlations</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="n">density</span><span class="p">,</span> <span class="n">angular_cutoff</span><span class="o">=</span><span class="n">angular_cutoff</span>
<span class="p">)</span>

<span class="c1"># Move the &quot;l_&quot; and &quot;k_&quot; keys to properties</span>
<span class="n">bispectrum_truncated</span> <span class="o">=</span> <span class="n">bispectrum_truncated</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;l_1&quot;</span><span class="p">,</span> <span class="s2">&quot;l_2&quot;</span><span class="p">,</span> <span class="s2">&quot;k_2&quot;</span><span class="p">,</span> <span class="s2">&quot;l_3&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;truncated bispectrum:&quot;</span><span class="p">,</span> <span class="n">bispectrum_truncated</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>truncated bispectrum: Labels(
    o3_lambda  o3_sigma  center_type
        0         1           1
        1         1           1
                  ...
        3         -1          8
        0         -1          8
)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first block:&quot;</span><span class="p">,</span> <span class="n">bispectrum_truncated</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>first block: TensorBlock
    samples (420): [&#39;system&#39;, &#39;atom&#39;]
    components (1): [&#39;o3_mu&#39;]
    properties (8640): [&#39;l_1&#39;, &#39;l_2&#39;, &#39;k_2&#39;, &#39;l_3&#39;, &#39;neighbor_1_type&#39;, &#39;n_1&#39;, &#39;neighbor_2_type&#39;, &#39;n_2&#39;, &#39;neighbor_3_type&#39;, &#39;n_3&#39;]
    gradients: None
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;total number of features:&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">bispectrum_truncated</span><span class="p">]),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>total number of features: 338688
</pre></div>
</div>
<p>To compute a descriptor that matches the symmetry of a given target property, the
<code class="docutils literal notranslate"><span class="pre">selected_keys</span></code> argument can be passed to the <code class="docutils literal notranslate"><span class="pre">compute</span></code> method. This was also seen
in the previous tutorial on <a class="reference internal" href="../examples/compute-lambda-soap.html#compute-lambda-soap"><span class="std std-ref">computing lambda-SOAP</span></a>.</p>
<p>Following this example, to compute the truncated bispectrum for a polarizability
tensor:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bispectrum_truncated_key_select</span> <span class="o">=</span> <span class="n">density_correlations</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="n">density</span><span class="p">,</span>
    <span class="n">angular_cutoff</span><span class="o">=</span><span class="n">angular_cutoff</span><span class="p">,</span>
    <span class="n">selected_keys</span><span class="o">=</span><span class="n">mts</span><span class="o">.</span><span class="n">Labels</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;o3_lambda&quot;</span><span class="p">,</span> <span class="s2">&quot;o3_sigma&quot;</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Move the &quot;l_&quot; and &quot;k_&quot; keys to properties</span>
<span class="n">bispectrum_truncated_key_select</span> <span class="o">=</span> <span class="n">bispectrum_truncated_key_select</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;l_1&quot;</span><span class="p">,</span> <span class="s2">&quot;l_2&quot;</span><span class="p">,</span> <span class="s2">&quot;k_2&quot;</span><span class="p">,</span> <span class="s2">&quot;l_3&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;truncated bispectrum with selected keys:&quot;</span><span class="p">,</span> <span class="n">bispectrum_truncated_key_select</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>truncated bispectrum with selected keys: Labels(
    o3_lambda  o3_sigma  center_type
        0         1           1
        2         1           1
                  ...
        0         1           8
        2         1           8
)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;total number of features:&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">bispectrum_truncated_key_select</span><span class="p">]),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>total number of features: 103680
</pre></div>
</div>
</section>
<section id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">DensityCorrelations</span></code> can be used to build equivariants of arbitrary body order from
a spherical expansion of decorated atomic point cloud data.</p>
<p>A key limitation of this approach is an exploding feature size. To reduce the number
of output blocks, the <code class="docutils literal notranslate"><span class="pre">angular_cutoff</span></code> parameter can be used.</p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="sample-selection.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Sample Selection</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="computing-lambda-soap.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Computing <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP features</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Guillaume Fraux, Philip Loche, Sergei Kliavinek, Kevin Kazuki Huguenin-Dumittan, Davide Tisi, Alexander Goscinski
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link fa-brands fa-github fa-2x" href="https://github.com/metatensor/featomic" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Computing density correlations</a><ul>
<li><a class="reference internal" href="#computing-the-spherical-expansion">Computing the spherical expansion</a></li>
<li><a class="reference internal" href="#density-correlations-to-build-a-lambda-soap">Density correlations to build a <span class="math notranslate nohighlight">\(\lambda\)</span>-SOAP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-bispectrum">Computing the bispectrum</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=1c28bd9a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>